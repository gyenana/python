###chapter 9. 웹 
- 월드 와이드 웹
    - HTTP / hyper text transfer protocol : 요청과 응답을 교환하기 위한 웹 서버와 클라이언트의 명세
    - HTML / hyper text markup language : 결과에 대한 표현 방식
    - URL / uniform resource locator : 고유의 해당 서버와 자원을 나타내는 방법
- 웹클라이언트 ( = 웹 브라우저) 가 HTTP 로 URL 을 요청하고 서버로부터 HTML 을 받는다.
- 거의 대부분의 컴퓨터 언어는 웹 클라이언트와 웹 서버를 작성하는데 사용되었으며, 파이썬은 모든 수준에서 웹 작업을 하는데 좋은 언어이다.
    - 원격 사이트에 접근할 수 있는 클라이언트
    - 웹 사이트와 웹 API에서 데이터를 제공하는 서버
    - 웹 페이지 이외의 데이터를 교환하기 위한 웹 API 와 서비스

### 9.1 웹 클라이언트

- 낮은 수준의 인터넷 네트워크 배관을 전송제어 프로토콜, 인터넷 프로토콜 이라고 부른다 = TCP/IP (transmission control protocol / internet protocol)
- TCP/IP는 컴퓨터간에 바이트를 전송하지만, 그것이 어떤 것을 의미하는 지에 대해서는 상관하지 않는다.

    [TCP / IP 정리 ](https://www.notion.so/TCP-IP-384315e77ec54e529b0497ef88ef770d)

    - 해석하는 일은 더 높은 수준의 프로토콜에서 처리
- HTTP 는 웹 데이터를 교환하는 표준 프로토콜이다.
    - 참고 : 컴퓨터와 네트워크 기기간 상호통신하기 위해서는 서로 같은 방법으로 통신해야 하는데, 서로 통신하기 위해서는 모든 요소에 규칙이 필요, 이 규칙을 프로토콜이라고 부름
- 웹은 클라이언트 - 서버 시스템으로, 클라이언트는 서버에 대한 요청을 만들고 이 요청이 TCP/IP 커넥션을 열고, HTTP를 통해 URL과 다른 정보들을 보낸다. 그리고 요청에 대한 응담을 받는다.
    - 응답포맷 또한 HTTP에 의해 정의, 요청에 대한 상태와 응답 데이터를 포함한다.
- 가장 잘 알려진 웹 클라이언트는 웹 브라우저, 웹 브라우저는 다양한 방법으로 HTTP요청을 만든다.
- HTTP의 중요한 점은 무상태라는 것 → 즉, 이전 데이터 요청과 다음 데이터 요청간 관련이 없다. 서로 독립적이다.
- 이는 기본적인 웹 작동을 단순하게 만들지만, 그 이외 사항은 복잡하게 만든다.
    - 캐싱 : 변하지 않는 원격 콘텐츠는 웹 클라이언트에 저장, 다시 서버로부터 이 컨텐츠의 다운로드를 피하기 위해 저장된 컨텐츠를 사용
    - 세션 : 쇼핑의 웹사이트는 장바구니의 컨텐츠를 기억해야 함
    - 인증 : 아이디와 비밀번호를 요구하는 사이트는 사용자가 로그인할 때 이 둘을 기억하여 사용자를 식별
- 무상태에 대한 해결책 중 '쿠키' 가 있음 → 쿠키란 서버가 클라이언트를 식별할 수 있도록 보내는 특정 정보

    [쿠키와 캐시 정리 ](https://www.notion.so/e44d53bb073c4d7d93705554b8942d75)

**9.1.1 텔넷으로 테스트하기** 

- HTTP 는 텍스트 기반 프로토콜, 웹 테스트를 위해 실제 텍스트를 입력할 수 있음
- 텔넷 프로그램은 서버의 포트에 연결하여 명령을 입력할 수 있다.  / TCP/IP 기반의 프로토콜
- 텔넷 : 원격지의 호스트 컴퓨터에 접속하기 위해 사용되는 인터넷 프로토콜이다. 사용자가 원거리에 위치한 컴퓨터를 사용할 수 있도록 하는 기능을 가지고 있다. 사용자는 네트워크 상의 컴퓨터에 로그인하여 원격지 컴퓨터의 기능을 사용할 수 있다. (from 나무위키)
- 가장 일반적인 HTTP명령 (웹 브라우저에서 주소창에 URL을 입력할 때 사용하는 메서드) 는 GET
    - 이는 HTML파일과 같은 지정된 리소스의 내용을 검색, 클라이언트에 반환
- HEAD 메소드는 리소스에 대한 몇가지 기본 정보를 검색한다.
    - HTTP HEAD 요청을 할때 헤더만 응답받으며, GET 또는 POST 명령을 사용할 때 홈페이지로 부터 데이터도 받게 된다.

**9.1.2 파이썬 표준 웹 라이브러리** 

- 파이썬 2에서는 웹 클라이언트와 서버 모듈은 조금씩 흩어져 있으나, 파이썬 3에서는 이들 모듈을 두개의 패키지로 묶었다.
- http 는 모든 클라이언트 - 서버 HTTP 세부사항을 관리
    - client 는 클라이언트 부분을 관리
    - server는 파이썬 웹 서버를 작성하는데 도움
    - cookies와 cookiejar는 사이트 방문자의 데이터를 저장하는 쿠키를 관리
- urllib 는 http 위에서 실행
    - request는 클라이언트의 요청을 처리
    - response는 서버의 응답을 처리
    - parse는 URL을 분석
- HTTP 상태코드
    - 1xx : 조건부응답 : 서버는 요청을 받았지만 클라이언트에 대한 몇가지 추가 정보가 필요
    - 2xx : 성공 : 성공적으로 처리되었다.
    - 3xx : 리다이렉션 : 리소스가 이전되어 클라이언트에 새로운 URL 을 응답
    - 4xx : 클라이언트 에러 : 자주 발생하는 404 는 클라이언트 측에 문제가 있음을 나타냄
        - 403 : 인증 없어서 권한 안됨 forbidden
    - 5xx : 서버 에러 : 웹 서버와 백엔드 애플리케이션 서버가 연결되어 있지 않다면 502 를 볼 것
        - 502 : 게이트웨이 오류
        - 503 : 서버가 뻗은거 , 호출을 받지 못하는 상태
        - 500 : 서버가 버그 생긴거 .... 내부에러.... → int 로 받아야되는데 조 단위로 값이 들어왔다던가
- 웹 서버는 원하는 포맷으로 데이터를 전송할 수 있음, 일반적으로 HTML ( or CSS or js ) 를 전송
    - 포맷은 HTTP 헤더의 content-type 값에 있음
- 파이썬 라이브러리는 모든 HTTP응답 헤더를 파싱하여 딕셔너리로 제공한다.

**9.1.3 표준 라이브러리를 넘어서 : Requests (써드파티의 모듈)** 

- 대부분의 경우 requests모듈을 사용하면 웹 클라이언트 개발이 더 쉬워진다.

### 9.2 웹 서버

- 파이썬은 웹 서버와 서버 사이드 프로그램을 작성하는데 뛰어난 언어로 웹 개발자들에게 알려져 있음
- 웹 프레임워크는 웹사이트를 구축할 수 있는 기능을 제공, 따라서 단순한 웹(HTTP) 보다 더 많은 작업을 수행한다.

**9.2.1 간단한 파이썬 웹 서버** 

- $pytyon -m http.server
    - 한 라인의 코드로 간단한 웹 서버를 실행할 수 있음, 이는 순수한 파이썬 HTTP서버를 구현한다.
    - 다음과 같은 초기 상태 메시지를 출력
    - serving HTTP on 0.0.0.0 port 8000
- 0.0.0.0 은 모든 TCP 주소를 의미, 웹 클라이언트는 서버가 어떤 주소를 가졌든 상관없이 그곳에 접근할 수 있다.

    127.0.0.1 - - [27/jun/2015 19:46:22] "GET / HTTP/1.1" 200 - 
    
    * 127.0.0.1 은 클라이언트의 ip 주소 
    * 첫번째 - 는 원격 사용자의 이름 
    * 두번째 - 는 로그인 사용자 이름 (요구한 경우) 
    * [27/jun/2015 19:46:22] 는 접근한 날짜와 시간 
    * "GET / HTTP/1.1" 는 웹 서버로 보내는 명령 
    	-> get : http 메서드 
    	-> 리소스 요청 / 
    	-> HTTP/1.1 : HTTP 1.1 버전 

- 서버는 요청에 대한 로그를 기록
- 같은 디렉터리에 다른 파일이 있는 경우 이들을 목록형태로 표시하며, 파일 클릭해 내려받을 수 있음
- 순수한 파이썬 서버는 빠른 테스트에 적합, 또한 프로세스를 죽여서 서버를 중지시킬 수 있음
- 이러한 기본 서버를 실제 웹 사이트에 사용하면 안됨 , 아파치나 엔진엑스같은 전통적인 웹서버는 정적 파일을 더 빠르게 제공한다.
- 간단한 기본 서버는 대규모의 서버들이 매개변수를 받아 동적인 컨텐츠를 처리하는 일을 수행할 수 없다.

[정적 웹과 동적 웹 ](https://www.notion.so/04556442c06f4b04bcbb4e11500b2a0b)

**9.2.2 웹 서버 게이트웨이 인터페이스** 

- 웹 초기 시절 공용 게이트웨이 인터페이스 ( common gateway interface , CGI) 는 클라이언트를 위해 웹 서버가 외부 프로그램을 실행, 그 결과를 반환하도록 설계됨
    - CGI는 클라이어트에서 받은 입력인자를 서버를 통해 처리, 외부 프로그램으로 전달한다. 이렇기 때문에 프로그램은 각 클라이언트의 접근을 위해 처음부터 다시 시작되며 이러한 접근 방식은 확장성을 떨어뜨린다.
- 이러한 시동 지연을 피하기 위해 개발자들은 웹 서버에 인터프리터를 두기 시작했는데,
    - 아파치는 mod_php 모듈 내에서는 PHP , mod_perl 모듈 내에서는 펄, mod_python 모듈 내에서는 파이썬을 실행
    - 이러한 동적 언어의 코드는 외부 프로그램이 아닌 장기적으로 작동하는 아파치 프로세스 내에서 실행된다.

        < 참고 / 아파치 > 
        아파치는 아파치 소프트웨어 재단에서 만든 웹 서버 프로그램 
        아파치는 확장성이 상당히 좋은데, 모듈이라는 개념으로 수많은 기능을 덧붙일 수 있음 
        

- 파이썬 웹 개발은 파이썬 웹 애플리케이션과 웹 서버간의 범용적인 API인 웹 서버 게이트웨이 인터페이스 (WSGI , web server gateway interface)의 정의로부터 시작되었음

[게이트웨이란 ? ](https://www.notion.so/ffbc40e17eb3444198a1f1708bac7784)

**9.2.3 프레임워크** 

- 프레임워크란?
    - 재사용 가능한 코드 혹은 일반적인 작업을 위한 확장 기능을 제공, 신뢰성있는 확장성 및 유지보수로 웹 애플리케이션 구축 시 개발자의 작업을 더 쉽게 만드는 코드 라이브러리

    [프레임워크와 라이브러리의 차이 ](https://www.notion.so/1063c2594d12465f9053f321817c0eac)

- 웹 서버는 HTTP와 WSGI의 세부 사항을 처리, 반면 웹 프레임워크 사용 시 파이썬 코드를 작성하여 강력한 웹사이트를 만들 수 있다.
- 웹사이트를 구축하기 위한 많은 파이썬 웹 프레임워크가 존재, 웹 프레임워크는 최소한 클라이언트의 요청과 서버의 응답을 처리해준다.
    - 라우트 : URL을 해석하여 해당 서버의 파일이나 파이썬 코드를 찾아줌 (어떤 주소를 받아 어떤 것을 보여줄지 정함)
    - 템플릿 : 서버 사이드의 데이터를 HTML 페이지에 병합
    - 인증 및 권한 : 사용자 이름과 비밀번호, 퍼미션을 처리
    - 세션 : 웹사이트에 방문하는 동안 사용자의 임시 데이터를 유지

**9.2.4 bottle** 

- Bottle 은 하나의 파이썬 파일로 구성되어 있어 시도해보기 쉬우며, 나중에 쉽게 배포할 수 있다. (파이썬의 표준 라이브러리 아님)
- 바틀 프레임워크는 파이썬을 위한 빠르고 간단하며 가벼운 wsgi 마이크로 웹 프레임 워크이다.
- 단일 파일 모듈로 배포되며, 파이썬 표준 라이브러리 이외의 종속성이 없다.

    from bottle import route, run, static_file
    
    
    @route('/') #함수와 URL 연결 '/' 는 home() 함수가 처리한다. 
    def home():
        return static_file('index.html', root='.')
    
    
    @route('/echo/<thing>')
    def echo(thing):
        return "Say hello to my little friend: %s!" % thing
    #새로운 echo() 함수는 URL에서 문자열 인자를 전달받음 
    
    #run 함수는 bottle 내 내장된 파이썬 테스트 웹 서버를 실행함 
    run(host='localhost', port=9999)
    

- 바틀에 대한 팁 , run() 함수 실행 시 아래 인자를 추가하여 실행할 수 있다.
    - debug=True : HTTP 에러가 발생하면 디버깅페이지를 생성한다.
    - reloader=True : 파이썬 코드가 변경되면 변경된 코드를 다시 불러온다.

**9.2.5 Flask** 

- 바틀은 좋은 초기의 웹 프레임워크, 더 많은 기능이 필요하다면 Flask 를 사용
- 플라스크는 바틀과 같이 간단하게 사용할 수 있지만, 페이스북 인증과 데이터 베이스 연결같이 전문적인 웹 개발에 유용한 많은 확장 기능을 지원한다.
- 플라스크는 작지만 강력한 파이썬 웹 프레임워크로 배우기 쉽고 짧은 시간에 웹앱 개발이 가능해 인기가 많다.
- 플라스크는 특별한 도구 또는 라리브러리가 필요없어 마이크로 프레임워크라 부르기도 한다.
- 플라스크는 여러 제안을 제공하지만 의존성이나 프로젝트 레이아웃을 강요하지 않는 것이 특징이며, 개발자가 사용하려는 도구와 라이브러리를 개발자 스스로가 선택하도록 한다.

    from flask import Flask, render_template
    
    app = Flask(__name__)
    
    @app.route('/')
    def home():
        return app.send_static_file('flask2.html')
    
    @app.route('/echo/<thing>')
    def echo(thing):
        return render_template('flask2.html', thing=thing)
    
    
    app.run(port=9999, debug=True)
    
    #debug=True 사용하면 예외 발생 시 어디에서 잘못되어있는지에 관한 내용을
    #특별한 형식의 페이지로 표시해줌 
    #그러나 서버에 대한 너무 많은 정보가 잠재적으로 노출될 수 있기 때문에 
    #배포 시에는 설정 ㄴㄴ 

**9.2.6 비파이썬 웹 서버** 

- 일반적으로 제품을 배포할 때에는 빠른 웹서버로 파이썬을 실행하는 것이 좋은데, 다음과 같은 것을 선택한다.
    - 아파치와 mod_wsgi 모듈
    - 엔진엑스와 uWSGI 앱 서버
- 아파치는 가장 인기가 많고 엔진엑스는 안정성과 메모리를 적게 사용하는 것으로 유명하다.

**아파치** 

- 아파치 웹서버에 최적화된 WSGI 모듈은 mod_wsgi 다. 이 모듈은 아파치 프로세스 안에서 혹은 아파치와 통신하기 위해 분리된 프로세스 안에서 파이썬 코드를 실행한다.
- 더 공부가 필요한 부분

**엔진엑스** 

- 엔진엑스 웹 서버는 파이썬 모듈이 없다. 대신 uWSGI와 같은 별도 WSGI서버를 사용하여 통신, 이들은 파이썬 웹 개발을 위해 매우 신속하고 설정 가능한 플랫폼을 만들어준다.

**9.2.7 기타 프레임워크** 

- 장고
    - 큰 규모의 사이트에서 가장 인기있는 프레임워크
    - 장고는 전형적인 CRUD (Create, read, update, delete) 웹 페이지를 자동으로 생성하기 위한 ORM 코드를 포함한다.
    - 개발자의 취향대로 SQLAlchemy 혹은 바로 SQL 쿼리를 사용해도 무방
- web2py : 장고와 비슷한 또 다른 스타일의 웹 프레임워크
- pyramid : 이 프레임워크는 pylons 프로젝트에서 성장, 장고와 범위가 비슷
- turbogears : 이 프레임워크는 ORM, 여러 데이터베이스 , 다중 템플릿 언어를 지원
- wheezy.web : 성능에 최적화된 새로운 웹 프레임워크
- 관계형 데이터베이스 기반의 웹 사이트를 구축하려는 경우, 반드시 큰 프레임워크를 선택할 필요는 없다.
    - 바틀, 플라스크 혹은 다른 웹 프레임워크에서 바로 관계형 데이터베이스 모듈로 연결하거나, sqlalchemy를 사용하여 사용하려는 프레임워크의 장점을 살릴 수 있다.
- 기타 파이썬 웹 서버
    - 아파치와 엔진엑스처럼 독립적인 파이선 기반의 wsgi 서버
    - uwsgi
    - cherrypy
    - pylons
    - 이벤트 기반의 서버 / 싱글 프로세스지만 하나의 요청에 대한 블로킹을 피함
    - tornado
    - gevent
    - gunicom

### 9.3 웹 서비스와 자동화

**9.3.2 웹 API 와 REST**                       

참고 링크 : [https://meetup.toast.com/posts/92](https://meetup.toast.com/posts/92)

- 웹 페이지 내에서만 데이터가 사용되는 경우가 있다.
- 웹 페이지 대신 웹 애플리케이션 프로그래밍 인터페이스(API) 를 통해 데이터를 제공할 수 있다.
- RESTful 서비스는 다음의 특정 HTTP 동사를 사용한다.
    - 참고 링크 : [https://gmlwjd9405.github.io/2018/09/21/rest-and-restful.html](https://gmlwjd9405.github.io/2018/09/21/rest-and-restful.html)
    - head : 실제 데이터가 아닌 리소스에 대한 정보를 얻어온다 → get list of movis
    - get : 서버에서 리소스의 데이터를 검색 → find a movie by its ID
    - post : 서버의 데이터를 생성 → create a new movie
    - put : 새로운 리소스를 생성 → update an existing movie
    - delete : 서버의 데이터를 삭제 → delete an existing movie
- restful 클라이언트는 HTTP 요청 헤더를 사용하여 서버로부터 하나 이상의 콘텐트 타입을 요청할 수 있음

**9.3.3 JSON** 

- 제이슨은 웹 클라이언트와 서버간에 데이터를 교환하는데 유용하게 쓰임
- 오픈스택과 같은 웹 기반의 API에서 인기가 높다

**9.3.4 크롤링과 스크래핑** 

- 크롤러, 스파이더 → 자동화된 웹 패처
- 원격 웹 서버에서 콘텐츠를 찾은 후 스크래퍼에서 원하는 정보를 찾기 위해 파싱
- Scrapy 는 beautifulSoup 와 같은 모듈이 아닌 프레임워크

**9.3.5 HTML 스크랩하기 : BeautifulSoup** 

- 웹 페이지의 HTML로 부터 데이터를 추출하고 싶다면 beautiful soup 은 좋은 선택
- 공개된 웹페이지의 HTML 대부분이 문법적으로 유효하지 않아 파싱이 생각보다 어려움
